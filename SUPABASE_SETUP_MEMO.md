-- ============================================================
-- Supabase 数据库部署备忘录 (Database Setup Memo)
-- ============================================================
-- 说明：
-- 本文件已修改为纯 SQL 格式。
-- 您可以按 Ctrl+A (全选) -> Ctrl+C (复制)，然后直接在 Supabase SQL Editor 中粘贴运行，
-- 不会再出现 "syntax error at or near ```" 的错误。
--
-- 包含内容：
-- 1. finance_data 表结构定义 (带完整中文注释)
-- 2. RLS 安全策略 (允许读写)
-- ============================================================

-- ------------------------------------------------------------
-- 1. 核心数据表 (Core Table)
-- ------------------------------------------------------------

-- 如果表已存在，先删除 (可选，取消下面一行的注释以重置)
-- drop table if exists finance_data;

-- 创建 finance_data 表
create table finance_data (
  id bigint generated by default as identity primary key, -- [系统自动] 唯一主键 ID，自动递增
  
  -- 基础信息
  company_name text,                                    -- [Excel] 公司名称 (供应商)
  department text,                                      -- [Excel] 部门 (如：肉部, 杂货, 菜部等)
  
  -- 发票信息
  invoice_number text,                                  -- [Excel] 发票号
  invoice_date date,                                    -- [Excel] 发票日期 (格式: YYYY-MM-DD)
  invoice_amount numeric,                               -- [Excel] 发票金额
  tps numeric,                                          -- [Excel] TPS 税额
  tvq numeric,                                          -- [Excel] TVQ 税额
  net_amount numeric,                                   -- [Excel] 税后净值
  
  -- 付款与支票信息
  check_number text,                                    -- [Excel] 付款支票号
  clear_flag text,                                      -- [Excel] 特殊标记清除 ("1" 表示清除相关支付信息)
  actual_paid_amount numeric,                           -- [Excel] 实际支付金额
  check_total_amount numeric,                           -- [Excel] 付款支票总额
  check_date date,                                      -- [Excel] 开支票日期 (即付款日期)
  check_mailed_date date,                               -- [Excel] 支票寄出日期
  
  -- 对账与备注
  bank_reconciliation_date date,                        -- [Excel] 银行对账日期
  bank_reconciliation_note text,                        -- [Excel] 银行对账备注
  difference numeric,                                   -- [Excel] 差额
  remarks text,                                         -- [Excel] 备注
  
  -- 系统字段
  created_at timestamp with time zone default timezone('utc'::text, now()) not null -- [系统自动] 创建时间
);

-- ------------------------------------------------------------
-- 2. 访问权限与安全策略 (RLS Policy)
-- ------------------------------------------------------------

-- 1. 开启表的行级安全功能
alter table finance_data enable row level security;

-- 2. 创建一个“允许所有”的策略
-- 只要有 API Key (Anon Key) 即可读写
create policy "Enable all access for all users"
on finance_data
for all
using (true)
with check (true);

-- ============================================================
-- 部署结束
-- 请确保在 .env.local 中更新您的 VITE_SUPABASE_URL 和 VITE_SUPABASE_ANON_KEY
-- ============================================================
