# 部署指南 (Deployment Guide)

## 1. Supabase 设置 (Database Setup)

1.  登录 [Supabase](https://supabase.com/) 并创建一个新项目 (New Project)。
2.  进入 SQL Editor (左侧菜单图标)，运行以下 SQL 代码以创建数据库表：

```sql
-- 创建 finance_data 表
create table finance_data (
  id bigint generated by default as identity primary key,
  company_name text,
  department text,
  invoice_number text,
  invoice_date date,
  invoice_amount numeric,
  tps numeric,
  tvq numeric,
  net_amount numeric,
  check_number text,
  clear_flag text,
  actual_paid_amount numeric,
  check_total_amount numeric,
  check_date date,
  check_mailed_date date,
  bank_reconciliation_date date,
  bank_reconciliation_note text,
  difference numeric,
  remarks text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 开启行级安全 (RLS)
alter table finance_data enable row level security;

-- 创建允许所有操作的策略 (注意：因为我们在前端使用硬编码密码，这里暂时允许所有拥有 API Key 的人读写，请确保 API Key 不泄露给非信任用户)
create policy "Enable all access for all users"
on finance_data
for all
using (true)
with check (true);
```

3.  创建完成后，进入 **Project Settings -> API**。
4.  复制 `Project URL` 和 `anon public` Key。

## 2. 本地运行 (Local Development)

1.  在项目根目录创建 `.env.local` 文件 (如果不存在)。
2.  添加以下内容：

```env
VITE_SUPABASE_URL=你的Supabase项目URL
VITE_SUPABASE_ANON_KEY=你的SupabaseAnonKey
```

3.  运行 `npm run dev` 启动项目。

## 3. Vercel 部署 (Vercel Deployment)

1.  将代码推送到 GitHub。
2.  登录 [Vercel](https://vercel.com/)，点击 **Add New -> Project**。
3.  导入你的 GitHub 仓库 (`xinya_gestion_finance`)。
4.  在 **Environment Variables** 部分，添加上面获取的 Supabase 变量：
    *   `VITE_SUPABASE_URL`
    *   `VITE_SUPABASE_ANON_KEY`
5.  点击 **Deploy**。

## 4. 管理员后台使用说明

1.  打开部署后的网站。
2.  点击右上角的 **盾牌图标** (Admin)。
3.  输入账号：`admin`，密码：`xinya-888`。
4.  **删除旧数据**：点击 "Purge Database" 红色按钮，这将清空数据库中所有数据。
5.  **上传新数据**：
    *   准备 Excel 文件，确保包含名为 `数据源` 的 Sheet。
    *   列名必须包含：`公司名称`, `部门`, `发票号`, `发票日期`, `发票金额`, `TPS`, `TVQ`, `税后净值`, `付款支票号`, `特殊标记清除`, `实际支付金额`, `付款支票总额`, `开支票日期`, `支票寄出日期`, `银行对账日期`, `银行对账日期备注`, `差额`, `备注`。
    *   点击上传区域选择文件，然后点击 "Execute Upload"。
6.  上传完成后，系统会自动刷新数据。
